!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),o.textContent=""},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)},o=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0};const a=document.getElementById("profile-avatar");a.src="2fc47fd8e9a9bcd9612f.jpg";const n=document.querySelector("#avatar-modal"),s=document.querySelector(".profile__avatar-edit"),c=n.querySelector(".modal__form"),l=n.querySelector("#profile-avatar-input"),d=document.querySelector(".cards__list"),i=document.querySelector(".profile__edit-button"),u=document.querySelector(".profile__name"),m=document.querySelector(".profile__description"),_=document.querySelector("#edit-modal"),h=_.querySelector("#name"),f=_.querySelector("#description"),v=_.querySelector(".modal__form"),p=document.querySelector(".profile__add-button"),y=document.querySelector("#new-post-modal"),S=y.querySelector("#card-image"),b=y.querySelector("#card-caption"),q=y.querySelector(".modal__form"),E=y.querySelector(".modal__submit-button"),k=document.querySelector("#preview-modal"),C=k.querySelector(".modal__image"),L=k.querySelector(".modal__caption"),g=document.querySelector("#delete-post-modal"),U=g.querySelector("#delete-form"),A=g.querySelector("#modal__cancel-button"),x=document.querySelectorAll(".modal__close-button"),$=document.querySelector("#card-template"),I=document.querySelectorAll(".modal"),w=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}editUserAvatar({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}addNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"a4f15128-4ba2-4653-a32c-921f0ed0e86f","Content-Type":"application/json"}});function R(e){e.classList.add("modal_opened"),document.addEventListener("keydown",D)}function B(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",D)}w.getAppInfo().then((([e,t])=>{e.forEach((e=>{d.append(N(e))})),u.textContent=t.name,m.textContent=t.about,a.src=t.avatar})).catch(console.error),x.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>B(t)))})),s.addEventListener("click",(()=>{R(n)})),c.addEventListener("submit",(function(e){e.preventDefault(),w.editUserAvatar({avatar:l.value}).then((e=>{a.src=e.avatar})).catch(console.error),B(n)})),i.addEventListener("click",(function(){h.value=u.textContent,f.value=m.textContent,((e,r,o)=>{r.forEach((r=>{t(e,r,o)}))})(v,[h,f],e),R(_)})),v.addEventListener("submit",(function(e){e.preventDefault(),w.editUserInfo({name:h.value,about:f.value}).then((e=>{u.textContent=e.name,m.textContent=e.about})).catch(console.error),B(_)}));const D=e=>{"Escape"===e.key&&(e.preventDefault(),B(document.querySelector(".modal_opened")))};function N(e){const t=$.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),a=t.querySelector(".card__like-button"),n=t.querySelector(".card__trash-button");let s,c;return a.addEventListener("click",(()=>{a.classList.toggle("card__like-button_liked")})),n.addEventListener("click",(()=>{!function(e,t){s=e,c=t._id,R(g)}(t,e)})),A.addEventListener("click",(()=>{B(g)})),o.addEventListener("click",(()=>{C.src=e.link,C.alt=e.name,L.textContent=e.name,R(k)})),r.textContent=e.name,o.src=e.link,o.alt=e.name,U.addEventListener("submit",(e=>{e.preventDefault(),w.deleteCard(c).then((()=>{s.remove(),B(g)})).catch(console.error)})),t}p.addEventListener("click",(()=>{R(y)})),q.addEventListener("submit",(function(t){t.preventDefault(),w.addNewCard({name:b.value,link:S.value}).then((e=>{const t={name:e.name,link:e.link,_id:e._id};d.prepend(N(t))})).catch(console.error),B(y),o(E,e),t.target.reset()})),I.forEach((e=>{e.addEventListener("click",(e=>{e.target.classList.contains("modal")&&B(e.target)}))})),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((o=>{((e,o)=>{const a=Array.from(e.querySelectorAll(o.inputSelector)),n=e.querySelector(o.submitButtonSelector);r(a,n,o),a.forEach((s=>{s.addEventListener("input",(()=>{((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{const a=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),a.textContent=r})(e,r,r.validationMessage,o)})(e,s,o),r(a,n,o)}))}))})(o,e)}))})(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Li9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKFxuICBmb3JtRWxlbWVudCxcbiAgaW5wdXRFbGVtZW50LFxuICB2YWxpZGF0aW9uTWVzc2FnZSxcbiAgc2V0dGluZ3NcbikgPT4ge1xuICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgKTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IHZhbGlkYXRpb25NZXNzYWdlO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICk7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoXG4gICAgICBmb3JtRWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgIHNldHRpbmdzXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcbiAgfSk7XG59O1xuXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gIH1cbn07XG5cbmNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbn07XG5cbmNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgaW5wdXRMaXN0LCBzZXR0aW5ncykgPT4ge1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBzZXR0aW5ncykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2V0dGluZ3MuaW5wdXRTZWxlY3RvcilcbiAgKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3JcbiAgKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChzZXR0aW5ncykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5mb3JtU2VsZWN0b3IpKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgc2V0dGluZ3MpO1xuICB9KTtcbn07XG5cbmV4cG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHJlc2V0VmFsaWRhdGlvbiwgZGlzYWJsZUJ1dHRvbiwgc2V0dGluZ3MgfTtcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG4gIHNldHRpbmdzLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgYXZhdGFyU3JjIGZyb20gXCIuLi9pbWFnZXMvYXZhdGFyLmpwZ1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5cbmNvbnN0IHNwb3RzQXZhdGFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9maWxlLWF2YXRhclwiKTtcbnNwb3RzQXZhdGFyLnNyYyA9IGF2YXRhclNyYztcblxuLy8gQXZhdGFyIGZvcm0gZWxlbWVudHNcbmNvbnN0IGF2YXRhckVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgYXZhdGFyRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWVkaXRcIik7XG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhckVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCIpO1xuXG5jb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5jb25zdCBlZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtbW9kYWxcIik7XG5jb25zdCBlZGl0TW9kYWxOYW1lSW5wdXQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNuYW1lXCIpO1xuY29uc3QgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgZWRpdE1vZGFsRm9ybSA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuXG5jb25zdCBuZXdQb3N0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuY29uc3QgbmV3UG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbEltYWdlVXJsID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1pbWFnZVwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbENhcHRpb24gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLWNhcHRpb25cIik7XG5jb25zdCBuZXdQb3N0TW9kYWxGb3JtID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBjYXJkU3VibWl0QnV0dG9uID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XG5cbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbEltYWdlID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBEZWxldGUgbW9kYWwgZWxlbWVudHNcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtcG9zdC1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZU1vZGFsRm9ybSA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWZvcm1cIik7XG5jb25zdCBkZWxldGVDYW5jZWxCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsX19jYW5jZWwtYnV0dG9uXCIpO1xuXG5jb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcblxuY29uc3QgbW9kYWxFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcImE0ZjE1MTI4LTRiYTItNDY1My1hMzJjLTkyMWYwZWQwZTg2ZlwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHVzZXJJbmZvXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goKGNhcmQpID0+IHtcbiAgICAgIGNhcmRMaXN0LmFwcGVuZChnZXRDYXJkRWxlbWVudChjYXJkKSk7XG4gICAgfSk7XG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VySW5mby5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xuICAgIHNwb3RzQXZhdGFyLnNyYyA9IHVzZXJJbmZvLmF2YXRhcjtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG4vLyBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlNhbnRhIEJhcmJhcmFcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTkwMjU1MDQxNTAyLTlhMjYwM2M2ZmQzOT9xPTgwJnc9MTkzNSZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0RcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiQXVzdGluXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTU4MzA5NzA5MDk3MC00ZDNiOTQwZWExYTA/cT04MCZ3PTE5NzQmYXV0bz1mb3JtYXQmZml0PWNyb3AmaXhsaWI9cmItNC4wLjMmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlNhbHQgTGFrZSBDaXR5XCIsXG4vLyAgICAgbGluazogXCJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTU0NjAxNzk1OS03ODdiZTU5YmRjYmI/cT04MCZ3PTE4NDgmYXV0bz1mb3JtYXQmZml0PWNyb3AmaXhsaWI9cmItNC4wLjMmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlZlbnR1cmFcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNzIyMTEzNDQ4NzUxLTVkYzk4OGE2NGFjOT9xPTgwJnc9MjEyNyZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0RcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiRGFsbGFzXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTcwNjE5NzEwNzQ0OS1mYmQzZmQxZjQ5YmM/cT04MCZ3PTIxMzcmYXV0bz1mb3JtYXQmZml0PWNyb3AmaXhsaWI9cmItNC4wLjMmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlNhbiBMdWlzIE9iaXNwb1wiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE1NzEwNzc1OTc5MjAtZTI5MTY5ODg2NzBkP3E9ODAmdz0yMDcwJmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMC4zJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxuLy8gICB9LFxuLy8gXTtcblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZUtleVByZXNzKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVLZXlQcmVzcyk7XG59XG5cbmNsb3NlQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgY29uc3QgcG9wdXAgPSBidXR0b24uY2xvc2VzdChcIi5tb2RhbFwiKTtcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKHBvcHVwKSk7XG59KTtcblxuZnVuY3Rpb24gb3BlbkVkaXRNb2RhbCgpIHtcbiAgZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XG4gIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBlZGl0TW9kYWxGb3JtLFxuICAgIFtlZGl0TW9kYWxOYW1lSW5wdXQsIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXRdLFxuICAgIHNldHRpbmdzXG4gICk7XG4gIG9wZW5Nb2RhbChlZGl0TW9kYWwpO1xufVxuXG5mdW5jdGlvbiBjbG9zZUVkaXRNb2RhbCgpIHtcbiAgY2xvc2VNb2RhbChlZGl0TW9kYWwpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUsXG4gICAgICBhYm91dDogZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG5cbiAgY2xvc2VFZGl0TW9kYWwoKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBhcGlcbiAgICAuZWRpdFVzZXJBdmF0YXIoe1xuICAgICAgYXZhdGFyOiBhdmF0YXJJbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBzcG90c0F2YXRhci5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuICBjbG9zZU1vZGFsKGF2YXRhckVkaXRNb2RhbCk7XG59XG5cbmF2YXRhckVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGF2YXRhckVkaXRNb2RhbCk7XG59KTtcblxuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvcGVuRWRpdE1vZGFsKTtcblxuZWRpdE1vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KTtcblxuY29uc3QgaGFuZGxlRXNjYXBlS2V5UHJlc3MgPSAoZXZ0KSA9PiB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgY3VycmVudE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9vcGVuZWRcIik7XG4gICAgY2xvc2VNb2RhbChjdXJyZW50TW9kYWwpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBhcGlcbiAgICAuYWRkTmV3Q2FyZCh7XG4gICAgICBuYW1lOiBuZXdQb3N0TW9kYWxDYXB0aW9uLnZhbHVlLFxuICAgICAgbGluazogbmV3UG9zdE1vZGFsSW1hZ2VVcmwudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY29uc3QgbmV3Q2FyZERhdGEgPSB7XG4gICAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgICAgbGluazogZGF0YS5saW5rLFxuICAgICAgICBfaWQ6IGRhdGEuX2lkLFxuICAgICAgfTtcbiAgICAgIGNhcmRMaXN0LnByZXBlbmQoZ2V0Q2FyZEVsZW1lbnQobmV3Q2FyZERhdGEpKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gIGRpc2FibGVCdXR0b24oY2FyZFN1Ym1pdEJ1dHRvbiwgc2V0dGluZ3MpO1xuICBldnQudGFyZ2V0LnJlc2V0KCk7XG59XG5cbm5ld1Bvc3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKG5ld1Bvc3RNb2RhbCk7XG59KTtcblxubmV3UG9zdE1vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRTdWJtaXQpO1xuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcblxuICBjb25zdCBjYXJkRWxlbWVudFRpdGxlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEVsZW1lbnRJbWFnZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IGxpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBjb25zdCB0cmFzaEJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdHJhc2gtYnV0dG9uXCIpO1xuICBsZXQgc2VsZWN0ZWRDYXJkO1xuICBsZXQgc2VsZWN0ZWRDYXJkSWQ7XG5cbiAgbGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xuICB9KTtcblxuICB0cmFzaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEpO1xuICB9KTtcblxuICBkZWxldGVDYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgfSk7XG5cbiAgY2FyZEVsZW1lbnRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByZXZpZXdNb2RhbEltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3TW9kYWxJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld01vZGFsQ2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcblxuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcblxuICBmdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhKSB7XG4gICAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gICAgc2VsZWN0ZWRDYXJkSWQgPSBkYXRhLl9pZDtcblxuICAgIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoKSB7XG4gICAgYXBpXG4gICAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gIH1cblxuICBjYXJkRWxlbWVudFRpdGxlLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICBjYXJkRWxlbWVudEltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgY2FyZEVsZW1lbnRJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG5cbiAgZGVsZXRlTW9kYWxGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGhhbmRsZURlbGV0ZVN1Ym1pdCgpO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbm1vZGFsRWxlbWVudHMuZm9yRWFjaCgobW9kYWwpID0+IHtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSkge1xuICAgICAgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZWRpdFVzZXJBdmF0YXIoeyBhdmF0YXIgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBhZGROZXdDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZUVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiYWRkIiwic3BvdHNBdmF0YXIiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwiYXZhdGFyRWRpdE1vZGFsIiwiYXZhdGFyRWRpdEJ1dHRvbiIsImF2YXRhckZvcm0iLCJhdmF0YXJJbnB1dCIsImNhcmRMaXN0IiwicHJvZmlsZUVkaXRCdXR0b24iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsImVkaXRNb2RhbCIsImVkaXRNb2RhbE5hbWVJbnB1dCIsImVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQiLCJlZGl0TW9kYWxGb3JtIiwibmV3UG9zdEJ1dHRvbiIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RNb2RhbEltYWdlVXJsIiwibmV3UG9zdE1vZGFsQ2FwdGlvbiIsIm5ld1Bvc3RNb2RhbEZvcm0iLCJjYXJkU3VibWl0QnV0dG9uIiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsSW1hZ2UiLCJwcmV2aWV3TW9kYWxDYXB0aW9uIiwiZGVsZXRlTW9kYWwiLCJkZWxldGVNb2RhbEZvcm0iLCJkZWxldGVDYW5jZWxCdXR0b24iLCJjbG9zZUJ1dHRvbnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY2FyZFRlbXBsYXRlIiwibW9kYWxFbGVtZW50cyIsImFwaSIsImNvbnN0cnVjdG9yIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsIl9jaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEFwcEluZm8iLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJhZGROZXdDYXJkIiwibGluayIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJhdXRob3JpemF0aW9uIiwib3Blbk1vZGFsIiwibW9kYWwiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlRXNjYXBlS2V5UHJlc3MiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNhcmRzIiwidXNlckluZm8iLCJmb3JFYWNoIiwiY2FyZCIsImFwcGVuZCIsImdldENhcmRFbGVtZW50IiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJidXR0b24iLCJwb3B1cCIsImNsb3Nlc3QiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwiZGF0YSIsInJlc2V0VmFsaWRhdGlvbiIsImtleSIsImNhcmRFbGVtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRFbGVtZW50VGl0bGUiLCJjYXJkRWxlbWVudEltYWdlIiwibGlrZUJ1dHRvbiIsInRyYXNoQnV0dG9uIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJ0b2dnbGUiLCJfaWQiLCJoYW5kbGVEZWxldGVDYXJkIiwiYWx0IiwibmV3Q2FyZERhdGEiLCJwcmVwZW5kIiwidGFyZ2V0IiwicmVzZXQiLCJjb250YWlucyIsIkFycmF5IiwiZnJvbSIsInNldEV2ZW50TGlzdGVuZXJzIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImVuYWJsZVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9